<TestPlan name="创建用户">
    <ThreadGroup name="创建用户线程组" threads="3" ramp_up="1">
        <VariableDataSet name="用户定义的变量">
            <stringProp name="u:username">admin</stringProp>
            <stringProp name="u:system_role_name">普通用户</stringProp>
        </VariableDataSet>
<!--        <CSVDataSet name="sqlData" filename="users/users.csv" >-->
<!--            <stringProp name="variableNames">dc_uname</stringProp>-->
<!--        </CSVDataSet>-->
        <DBDataSet name="sqlData">
            <stringProp name="ip">192.168.3.220</stringProp>
            <stringProp name="port">3306</stringProp>
            <stringProp name="username">admin</stringProp>
            <stringProp name="password">whdata123</stringProp>
            <stringProp name="database">str</stringProp>
            <stringProp name="sql">SELECT t_user_name FROM str_user_template; </stringProp>
            <stringProp name="variableNames">dc_uname</stringProp>
        </DBDataSet>
        <HttpSampler name="获取auth">
            <CacheDataSet name="cache data set">
                <cacheProp name="c:interface">get_auth</cacheProp>
                <cacheProp name="c:env">all</cacheProp>
            </CacheDataSet>
            <HeadExtractor name="header提取器" parentname="获取auth">
                <HeaderProp name="h:Auth">$.data[0]</HeaderProp>
             </HeadExtractor>
        </HttpSampler>
        <HttpSampler name="查询组织">
            <CacheDataSet name="cache data set">
                <cacheProp name="c:interface">find_organizations</cacheProp>
                <cacheProp name="c:env">all</cacheProp>
            </CacheDataSet>
            <ExpressionExtractor name="提取" parentname="查询组织">
                <ExpressionProp name="e:organization_id">$.data[1].id</ExpressionProp>
            </ExpressionExtractor>
        </HttpSampler>
        <HttpSampler name="查询角色">
            <CacheDataSet name="cache data set">
                <cacheProp name="c:interface">find_system_role</cacheProp>
                <cacheProp name="c:env">all</cacheProp>
            </CacheDataSet>
            <ExpressionExtractor name="提取" parentname="查询角色">
                <ExpressionProp name="e:role_ids">$.data.records[0].id</ExpressionProp>
            </ExpressionExtractor>
        </HttpSampler>
        <HttpSampler name="创建用户">
            <CacheDataSet name="cache data set">
                <cacheProp name="c:interface">create_system_user</cacheProp>
                <cacheProp name="c:env">all</cacheProp>
            </CacheDataSet>
            <ResponseAssertion name="响应断言" parentname="创建用户" selfVerification="true">
                <AssertProp name="a:message">用户创建成功</AssertProp>
            </ResponseAssertion>
        </HttpSampler>
<!--        <ResultReportingListener name="创建组织"/>-->
    </ThreadGroup>
</TestPlan>